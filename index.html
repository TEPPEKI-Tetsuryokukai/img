<!DOCTYPE html>
<html>
<head>
    <title>Free File Hosting</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 20px 0; }
        .url-display { margin-top: 20px; word-break: break-all; }
    </style>
</head>
<body>
    <h1>Free File Hosting</h1>
    
    <div class="upload-area" id="dropZone">
        <p>ファイルをドラッグ＆ドロップまたはクリックして選択</p>
        <input type="file" id="fileInput" multiple style="display: none;">
        <button onclick="document.getElementById('fileInput').click()">ファイルを選択</button>
    </div>

    <div id="urlDisplay" class="url-display" style="display: none;">
        <h3>アップロード完了！</h3>
        <p>URL: <a id="fileUrl" target="_blank"></a></p>
        <button onclick="copyUrl()">URLをコピー</button>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const urlDisplay = document.getElementById('urlDisplay');
        const fileUrl = document.getElementById('fileUrl');

        // ドラッグ＆ドロップの処理
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.backgroundColor = '#f0f0f0';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.backgroundColor = '';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.backgroundColor = '';
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        async function handleFiles(files) {
            for (let file of files) {
                await uploadFile(file);
            }
        }

        async function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);

            try {
                // GitHub APIを使用してアップロード
                const response = await fetch(
                    `https://api.github.com/repos/${getRepoPath()}/contents/uploads/${getFileType(file.type)}/${file.name}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${getAccessToken()}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: `Add ${file.name}`,
                            content: await toBase64(file)
                        })
                    }
                );

                if (response.ok) {
                    const data = await response.json();
                    const rawUrl = data.content.download_url
                        .replace('github.com', 'raw.githubusercontent.com')
                        .replace('/blob/', '/');
                    
                    fileUrl.href = rawUrl;
                    fileUrl.textContent = rawUrl;
                    urlDisplay.style.display = 'block';
                }
            } catch (error) {
                console.error('Upload error:', error);
            }
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        function getRepoPath() {
            // リポジトリパスを取得（手動設定が必要）
            return 'your-username/your-repo';
        }

        function getAccessToken() {
            // 個人アクセストークン（要設定）
            return 'your-github-token';
        }

        function getFileType(mimeType) {
            if (mimeType.startsWith('image/')) return 'images';
            if (mimeType.startsWith('video/')) return 'videos';
            return 'files';
        }

        function copyUrl() {
            navigator.clipboard.writeText(fileUrl.href);
            alert('URLをコピーしました！');
        }
    </script>
</body>
</html>
