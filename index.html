<!DOCTYPE html>
<html>
<head>
    <title>GitHub File Hosting</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 20px 0; }
        .url-display { margin-top: 20px; word-break: break-all; }
        .loading { display: none; color: blue; }
    </style>
</head>
<body>
    <h1>GitHub File Hosting</h1>
    
    <div class="upload-area" id="dropZone">
        <p>ファイルをドラッグ＆ドロップまたはクリックして選択</p>
        <input type="file" id="fileInput" multiple style="display: none;">
        <button onclick="document.getElementById('fileInput').click()">ファイルを選択</button>
    </div>

    <div id="loading" class="loading">
        <p>アップロード中... Issueが作成されるまでお待ちください</p>
    </div>

    <div id="issueLink" style="display: none; margin-top: 20px;">
        <p>アップロード処理中: <a id="issueUrl" target="_blank"></a></p>
        <p>数分後に自動的にURLが表示されます</p>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const loading = document.getElementById('loading');
        const issueLink = document.getElementById('issueLink');
        const issueUrl = document.getElementById('issueUrl');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.backgroundColor = '#f0f0f0';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.backgroundColor = '';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.backgroundColor = '';
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        async function handleFiles(files) {
            for (let file of files) {
                await createUploadIssue(file);
            }
        }

        async function createUploadIssue(file) {
            try {
                loading.style.display = 'block';
                
                const base64Data = await toBase64(file);
                const repoPath = window.location.pathname.split('/').slice(1, 3).join('/');
                
                // GitHubのIssue作成ページにリダイレクト
                const issueUrl = `https://github.com/${repoPath}/issues/new?template=upload.md&title=Upload: ${encodeURIComponent(file.name)}`;
                
                // フォームデータをlocalStorageに一時保存
                localStorage.setItem('uploadFileData', base64Data);
                localStorage.setItem('uploadFileName', file.name);
                
                window.open(issueUrl, '_blank');
                
                issueUrl.href = issueUrl;
                issueUrl.textContent = issueUrl;
                issueLink.style.display = 'block';
                
            } catch (error) {
                console.error('Error:', error);
                alert('エラーが発生しました');
            }
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // ページ読み込み時に保存されたデータがある場合、自動入力
        window.addEventListener('load', () => {
            const savedData = localStorage.getItem('uploadFileData');
            const savedName = localStorage.getItem('uploadFileName');
            
            if (savedData && savedName) {
                localStorage.removeItem('uploadFileData');
                localStorage.removeItem('uploadFileName');
                
                // ユーザーに確認
                if (confirm('前回のアップロードデータがあります。Issueページを開きますか？')) {
                    const repoPath = window.location.pathname.split('/').slice(1, 3).join('/');
                    const issueUrl = `https://github.com/${repoPath}/issues/new?template=upload.md&title=Upload: ${encodeURIComponent(savedName)}`;
                    window.open(issueUrl, '_blank');
                }
            }
        });
    </script>
</body>
</html>
